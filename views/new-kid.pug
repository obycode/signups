html
  head
    title Empower4Life Signups - Add Kid
    meta(charset="utf-8")
    meta(name="viewport" content="width=device-width, initial-scale=1, user-scalable=no")
    link(rel="stylesheet" href="/assets/css/main.css")
  body(class="landing is-preload")
    - var title = 'Add Kid';
    include header
    .outer-main
      main
        section(class="Main-content")
          if errors
            .errors
              ul
              each error in errors
                li #{error.msg}
          if success
            .success
              p Form submitted successfully!

          form.signup(method="POST" action="/add-kid")
            include kid-form.pug
            input#code.form-control(type='hidden' name='code' value=code)

            .center
              button(type='submit' class='button-style button-style2') Add Kid
              p 
                a(href='/event/' + kid.event) cancel
    include footer

    script.
      document.addEventListener('DOMContentLoaded', function() {
        const shelterSelect = document.getElementById('shelter');
        const additionalInfo = document.getElementById('additional-info');

        if (!shelterSelect || !additionalInfo) {
          return;
        }

        const contactInputs = Array.from(
          additionalInfo.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"]')
        );
        const bcpsId = shelterSelect.dataset.bcpsId;

        function toggleAdditionalInfo() {
          if (!bcpsId) {
            additionalInfo.style.display = 'none';
            contactInputs.forEach((input) => input.removeAttribute('required'));
            return;
          }

          const isBCPS = shelterSelect.value === bcpsId;
          additionalInfo.style.display = isBCPS ? 'block' : 'none';
          contactInputs.forEach((input) => {
            if (isBCPS) {
              input.setAttribute('required', 'required');
            } else {
              input.removeAttribute('required');
            }
          });
        }

        shelterSelect.addEventListener('change', toggleAdditionalInfo);
        toggleAdditionalInfo();
      });
